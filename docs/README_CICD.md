# ๐ Casino Backend CI/CD System

ะะพะปะฝะฐั ัะธััะตะผะฐ ะฝะตะฟัะตััะฒะฝะพะน ะธะฝัะตะณัะฐัะธะธ ะธ ัะฐะทะฒะตัััะฒะฐะฝะธั (CI/CD) ะดะปั Casino Backend ะฝะฐ Go.

## ๐ ะะฑะทะพั ัะธััะตะผั

ะะฐัะฐ CI/CD ัะธััะตะผะฐ ะพะฑะตัะฟะตัะธะฒะฐะตั:
- โ **ะะฒัะพะผะฐัะธัะตัะบัั ัะฑะพัะบั** ะฟัะธ ะบะฐะถะดะพะผ ะบะพะผะผะธัะต
- ๐งช **ะะฐะฟััะบ ัะตััะพะฒ** ะฟะตัะตะด ัะฐะทะฒะตัััะฒะฐะฝะธะตะผ
- ๐ **ะะฒัะพะผะฐัะธัะตัะบะพะต ัะฐะทะฒะตัััะฒะฐะฝะธะต** ะฝะฐ production
- ๐๏ธ **ะััะฝะพะต ัะฟัะฐะฒะปะตะฝะธะต** ะดะตะฟะปะพัะผะธ
- ๐ **ะะพะฝะธัะพัะธะฝะณ** ะธ health-checks
- ๐ **ะฃะฒะตะดะพะผะปะตะฝะธั** ะฒ Slack/Telegram/Discord/Email
- ๐ **Rollback** ะฟัะธ ะฝะตัะดะฐัะฝะพะผ ะดะตะฟะปะพะต

## ๐๏ธ ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
โ   Developer     โ    โ   GitHub         โ    โ   Production    โ
โ                 โ    โ                  โ    โ   Server        โ
โ  git push  โโโโโบโโโโโโโบ GitHub Actions โโโโโโโโบ Deployment     โ
โ                 โ    โ                  โ    โ                 โ
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
                       โโโโโโโโโโโโโโโโ
                       โ Notificationsโ
                       โ Slack/Telegramโ
                       โ Discord/Email โ
                       โโโโโโโโโโโโโโโโ
```

## ๐ ะกัััะบัััะฐ ัะฐะนะปะพะฒ CI/CD

```
.github/workflows/
โโโ deploy.yml              # ะะฒัะพะผะฐัะธัะตัะบะธะน ะดะตะฟะปะพะน
โโโ manual-deploy.yml       # ะััะฝะพะน ะดะตะฟะปะพะน ั ะฟะฐัะฐะผะตััะฐะผะธ
โโโ notifications.yml       # ะฃะฒะตะดะพะผะปะตะฝะธั ะพ ัะตะทัะปััะฐัะฐั

scripts/
โโโ setup-github-secrets.md # ะะฝััััะบัะธั ะฟะพ ะฝะฐัััะพะนะบะต

go-backend/
โโโ deploy/                 # ะกะบัะธะฟัั ัะฐะทะฒะตัััะฒะฐะฝะธั
โ   โโโ scripts/
โ   โ   โโโ install.sh      # ะฃััะฐะฝะพะฒะบะฐ ัะตัะฒะธัะฐ
โ   โ   โโโ update.sh       # ะะฑะฝะพะฒะปะตะฝะธะต ัะตัะฒะธัะฐ
โ   โ   โโโ uninstall.sh    # ะฃะดะฐะปะตะฝะธะต ัะตัะฒะธัะฐ
โ   โ   โโโ setup-postgres.sh
โ   โโโ systemd/
โ   โ   โโโ casino-backend.service
โ   โโโ nginx/
โ       โโโ casino-backend.conf
โโโ internal/handlers/
โ   โโโ health_test.go      # ะขะตััั ะดะปั CI
โโโ env.example             # ะัะธะผะตั ะฟะตัะตะผะตะฝะฝัั ะพะบััะถะตะฝะธั
```

## ๐ Workflow ะฟัะพัะตััั

### 1. ะะฒัะพะผะฐัะธัะตัะบะธะน ะดะตะฟะปะพะน (`deploy.yml`)

**ะขัะธะณะณะตัั:**
- Push ะฒ ะฒะตัะบั `main`/`master`
- ะะทะผะตะฝะตะฝะธั ะฒ ะฟะฐะฟะบะต `go-backend/`

**ะญัะฐะฟั:**
1. **Build** - ัะฑะพัะบะฐ Go ะฟัะธะปะพะถะตะฝะธั
2. **Test** - ะทะฐะฟััะบ ะฒัะตั ัะตััะพะฒ
3. **Package** - ัะพะทะดะฐะฝะธะต ะดะตะฟะปะพะน ะฟะฐะบะตัะฐ
4. **Deploy** - ัะฐะทะฒะตัััะฒะฐะฝะธะต ะฝะฐ ัะตัะฒะตั
5. **Health Check** - ะฟัะพะฒะตัะบะฐ ัะฐะฑะพัะพัะฟะพัะพะฑะฝะพััะธ

### 2. ะััะฝะพะน ะดะตะฟะปะพะน (`manual-deploy.yml`)

**ะะฐัะฐะผะตััั:**
- **Environment**: production/staging/development
- **Branch**: ะปัะฑะฐั ะฒะตัะบะฐ ะดะปั ะดะตะฟะปะพั
- **Skip tests**: ะฟัะพะฟัััะธัั ัะตััั
- **Force deploy**: ะฟัะธะฝัะดะธัะตะปัะฝัะน ะดะตะฟะปะพะน

**ะัะพะฑะตะฝะฝะพััะธ:**
- ะะพะดะดะตัะถะบะฐ ะผะฝะพะถะตััะฒะตะฝะฝัั ะพะบััะถะตะฝะธะน
- ะะตัะฐะปัะฝัะต ะปะพะณะธ ัะฐะทะฒะตัััะฒะฐะฝะธั
- ะะตัะฐะดะฐะฝะฝัะต ะพ ะดะตะฟะปะพะต

### 3. ะฃะฒะตะดะพะผะปะตะฝะธั (`notifications.yml`)

**ะะพะดะดะตัะถะธะฒะฐะตะผัะต ะฟะปะฐััะพัะผั:**
- ๐ฑ **Slack** - ั ะบะฝะพะฟะบะฐะผะธ ะธ ัะพัะผะฐัะธัะพะฒะฐะฝะธะตะผ
- ๐ **Telegram** - ั Markdown ัะพัะผะฐัะธัะพะฒะฐะฝะธะตะผ
- ๐ฎ **Discord** - ั embed ัะพะพะฑัะตะฝะธัะผะธ
- ๐ง **Email** - ั HTML ัะพัะผะฐัะธัะพะฒะฐะฝะธะตะผ

## โ๏ธ ะะฐัััะพะนะบะฐ

### ะัััััะน ััะฐัั (5 ะผะธะฝัั)

1. **ะะฐัััะพะนัะต SSH ะบะปััะธ:**
```bash
ssh-keygen -t ed25519 -C "github-actions@casino" -f ~/.ssh/casino_deploy_key
ssh-copy-id -i ~/.ssh/casino_deploy_key.pub username@your-server.com
```

2. **ะะพะฑะฐะฒััะต GitHub Secrets:**
   - `SSH_PRIVATE_KEY` - ะฟัะธะฒะฐัะฝัะน SSH ะบะปัั
   - `SERVER_HOST` - ะฐะดัะตั ัะตัะฒะตัะฐ
   - `SERVER_USER` - ะฟะพะปัะทะพะฒะฐัะตะปั SSH

3. **ะะพะดะณะพัะพะฒััะต ัะตัะฒะตั:**
```bash
sudo useradd -m -s /bin/bash deploy
sudo usermod -aG sudo deploy
echo "deploy ALL=(ALL) NOPASSWD: ALL" | sudo tee /etc/sudoers.d/deploy
```

4. **ะกะดะตะปะฐะนัะต ัะตััะพะฒัะน ะบะพะผะผะธั:**
```bash
git add .
git commit -m "feat: setup CI/CD"
git push origin main
```

### ะะตัะฐะปัะฝะฐั ะฝะฐัััะพะนะบะฐ

ะกะผ. ะดะพะบัะผะตะฝัั:
- [`CI_CD_QUICK_START.md`](CI_CD_QUICK_START.md) - ะฑัััััะน ััะฐัั
- [`scripts/setup-github-secrets.md`](scripts/setup-github-secrets.md) - ะฝะฐัััะพะนะบะฐ secrets

## ๐ ะะตะทะพะฟะฐัะฝะพััั

### ะะตะบะพะผะตะฝะดะฐัะธะธ:
- โ ะัะฟะพะปัะทัะนัะต ะพัะดะตะปัะฝะพะณะพ ะฟะพะปัะทะพะฒะฐัะตะปั ะดะปั ะดะตะฟะปะพั
- โ ะะณัะฐะฝะธัััะต sudo ะฟัะฐะฒะฐ ัะพะปัะบะพ ะฝะตะพะฑัะพะดะธะผัะผะธ ะบะพะผะฐะฝะดะฐะผะธ
- โ ะะตะณัะปััะฝะพ ัะพัะธััะนัะต SSH ะบะปััะธ
- โ ะะฐัััะพะนัะต ะผะพะฝะธัะพัะธะฝะณ SSH ะฟะพะดะบะปััะตะฝะธะน
- โ ะัะฟะพะปัะทัะนัะต GitHub Environments ะดะปั production

### ะะณัะฐะฝะธัะตะฝะฝัะต sudo ะฟัะฐะฒะฐ:
```bash
# /etc/sudoers.d/deploy
deploy ALL=(ALL) NOPASSWD: /bin/systemctl start casino-backend
deploy ALL=(ALL) NOPASSWD: /bin/systemctl stop casino-backend
deploy ALL=(ALL) NOPASSWD: /bin/systemctl restart casino-backend
deploy ALL=(ALL) NOPASSWD: /bin/systemctl status casino-backend
deploy ALL=(ALL) NOPASSWD: /bin/journalctl -u casino-backend *
```

## ๐ ะะพะฝะธัะพัะธะฝะณ

### GitHub Actions
- ะะพะณะธ ะฒัะตั ััะฐะฟะพะฒ ัะฐะทะฒะตัััะฒะฐะฝะธั
- ะัะตะผั ะฒัะฟะพะปะฝะตะฝะธั ะบะฐะถะดะพะณะพ ัะฐะณะฐ
- ะััะตัะฐะบัั ัะฑะพัะบะธ (30 ะดะฝะตะน)

### ะะฐ ัะตัะฒะตัะต
```bash
# ะะพะณะธ ัะตัะฒะธัะฐ
sudo journalctl -u casino-backend -f

# ะกัะฐััั ัะตัะฒะธัะฐ
sudo systemctl status casino-backend

# ะัะพะฒะตัะบะฐ API
curl http://localhost:8080/health
```

### ะฃะฒะตะดะพะผะปะตะฝะธั
ะะฒัะพะผะฐัะธัะตัะบะธะต ัะฒะตะดะพะผะปะตะฝะธั ะพ:
- โ ะฃัะฟะตัะฝะพะผ ะดะตะฟะปะพะต
- โ ะะตัะดะฐัะฝะพะผ ะดะตะฟะปะพะต
- โ๏ธ ะัะพะฑะปะตะผะฐั ั health check

## ๐จ Troubleshooting

### ะงะฐัััะต ะฟัะพะฑะปะตะผั:

**1. SSH ะพัะธะฑะบะธ**
```bash
# ะัะพะฒะตัะบะฐ ะฟะพะดะบะปััะตะฝะธั
ssh -i ~/.ssh/casino_deploy_key -v username@server

# ะัะพะฒะตัะบะฐ ะฟัะฐะฒ
ls -la ~/.ssh/
```

**2. ะะตะฟะปะพะน ะฝะต ะทะฐะฟััะบะฐะตััั**
- ะฃะฑะตะดะธัะตัั, ััะพ ะธะทะผะตะฝะตะฝะธั ะฒ `go-backend/`
- ะัะพะฒะตัััะต ะฒะตัะบั (ะดะพะปะถะฝะฐ ะฑััั `main`)
- ะัะพะฒะตัััะต GitHub Actions

**3. ะกะตัะฒะธั ะฝะต ะทะฐะฟััะบะฐะตััั**
```bash
# ะะพะณะธ ัะตัะฒะธัะฐ
sudo journalctl -u casino-backend -n 50

# ะัะพะฒะตัะบะฐ ัะฐะนะปะพะฒ
ls -la /opt/casino-backend/
```

**4. Health check ะฝะต ะฟัะพัะพะดะธั**
- ะัะพะฒะตัััะต firewall
- ะฃะฑะตะดะธัะตัั, ััะพ ะฟะพัั 8080 ะพัะบััั
- ะัะพะฒะตัััะต ะปะพะณะธ ะฟัะธะปะพะถะตะฝะธั

### Rollback

ะัะธ ะฝะตัะดะฐัะฝะพะผ ะดะตะฟะปะพะต:
```bash
# ะะฒัะพะผะฐัะธัะตัะบะธะน rollback (ะฒัััะพะตะฝ ะฒ update.sh)
cd /opt/casino-backend
sudo systemctl stop casino-backend
sudo cp casino-server.backup.* casino-server
sudo systemctl start casino-backend
```

## ๐ฏ ะัะธะผะตัั ะธัะฟะพะปัะทะพะฒะฐะฝะธั

### ะะฑััะฝัะน ะดะตะฟะปะพะน
```bash
git add .
git commit -m "feat: add new feature"
git push origin main
# ะะฒัะพะผะฐัะธัะตัะบะธ ัะฐะทะฒะตัะฝะตััั ะฝะฐ production
```

### Hotfix ะดะตะฟะปะพะน
```bash
git checkout -b hotfix/critical-bug
# Fix the bug
git commit -m "fix: critical bug"
git push origin hotfix/critical-bug

# ะััะฝะพะน ะดะตะฟะปะพะน ัะตัะตะท GitHub Actions:
# 1. Actions โ Manual Deploy
# 2. Branch: hotfix/critical-bug
# 3. Environment: production
# 4. Force deploy: true
```

### Staging ะดะตะฟะปะพะน
```bash
git push origin develop

# ะััะฝะพะน ะดะตะฟะปะพะน:
# 1. Actions โ Manual Deploy
# 2. Branch: develop
# 3. Environment: staging
```

## ๐ ะะตััะธะบะธ ะธ ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััั

### ะัะตะผั ะดะตะฟะปะพั:
- **Build**: ~2-3 ะผะธะฝััั
- **Deploy**: ~30-60 ัะตะบัะฝะด
- **Health Check**: ~10 ัะตะบัะฝะด
- **ะะฑัะตะต ะฒัะตะผั**: ~3-5 ะผะธะฝัั

### ะะตััััั:
- **GitHub Actions**: 2000 ะผะธะฝัั/ะผะตััั (ะฑะตัะฟะปะฐัะฝะพ)
- **ะััะตัะฐะบัั**: ะดะพ 500MB
- **Concurrent jobs**: ะดะพ 20

## ๐ ะะฑะฝะพะฒะปะตะฝะธั ัะธััะตะผั

### ะะฑะฝะพะฒะปะตะฝะธะต workflows:
1. ะะทะผะตะฝะธัะต ัะฐะนะปั ะฒ `.github/workflows/`
2. ะะพะผะผะธั ะธะทะผะตะฝะตะฝะธะน
3. ะะพะฒัะต ะฟัะฐะฒะธะปะฐ ะฟัะธะผะตะฝัััั ะฐะฒัะพะผะฐัะธัะตัะบะธ

### ะะฑะฝะพะฒะปะตะฝะธะต ัะบัะธะฟัะพะฒ ะดะตะฟะปะพั:
1. ะะฑะฝะพะฒะธัะต ัะฐะนะปั ะฒ `go-backend/deploy/`
2. ะะพะผะผะธั ะธ push
3. ะกะปะตะดัััะธะน ะดะตะฟะปะพะน ะธัะฟะพะปัะทัะตั ะฝะพะฒัะต ัะบัะธะฟัั

## ๐ ะัะตะธะผััะตััะฒะฐ ัะธััะตะผั

- ๐ **ะัััััะต ะดะตะฟะปะพะธ** - 3-5 ะผะธะฝัั ะพั ะบะพะผะผะธัะฐ ะดะพ production
- ๐ **ะะตะทะพะฟะฐัะฝะพััั** - ะธะทะพะปะธัะพะฒะฐะฝะฝัะต SSH ะบะปััะธ ะธ ะฟะพะปัะทะพะฒะฐัะตะปะธ
- ๐ **ะัะพะทัะฐัะฝะพััั** - ะฟะพะปะฝัะต ะปะพะณะธ ะฒัะตั ะพะฟะตัะฐัะธะน
- ๐ **ะะฐะดะตะถะฝะพััั** - ะฐะฒัะพะผะฐัะธัะตัะบะธะน rollback ะฟัะธ ะพัะธะฑะบะฐั
- ๐ **ะฃะฒะตะดะพะผะปะตะฝะธั** - ะผะณะฝะพะฒะตะฝะฝะฐั ะธะฝัะพัะผะฐัะธั ะพ ััะฐัััะต
- ๐๏ธ **ะะธะฑะบะพััั** - ัััะฝะพะต ัะฟัะฐะฒะปะตะฝะธะต ะธ ะผะฝะพะถะตััะฒะตะฝะฝัะต ะพะบััะถะตะฝะธั

---

**๐ก ะกะธััะตะผะฐ ะณะพัะพะฒะฐ ะบ ะธัะฟะพะปัะทะพะฒะฐะฝะธั! ะะฐะถะดัะน ะบะพะผะผะธั ัะตะฟะตัั ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะฐะทะฒะตัััะฒะฐะตััั ะฝะฐ ัะตัะฒะตั ั ะฟะพะปะฝัะผ ะบะพะฝััะพะปะตะผ ะบะฐัะตััะฒะฐ ะธ ะฑะตะทะพะฟะฐัะฝะพััะธ.** 